name: Publish Package to GitHub NPM Registry

# This workflow runs ONLY when a GitHub Release is published
on:
  release:
    types: [published]

jobs:
  npm-package:
    # Use GitHub-hosted Ubuntu runner
    runs-on: ubuntu-latest

    # Explicit permissions (best practice)
    # contents: read  -> required to checkout code
    # packages: write -> required to publish to GitHub Packages
    permissions:
      contents: read
      packages: write

    steps:
      # 1️⃣ Checkout repository source code
      # This pulls the exact commit associated with the release
      - name: Checkout Repository
        uses: actions/checkout@v4

      # 2️⃣ Setup Node.js environment
      # - Installs Node.js 20.x
      # - Configures npm to use GitHub Packages registry
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          registry-url: https://npm.pkg.github.com
          # registry-url tells npm WHERE to publish packages

      # 3️⃣ Install dependencies
      # npm ci is preferred in CI:
      # - Faster
      # - Uses package-lock.json strictly
      # - Fails if lockfile & package.json mismatch
      - name: Install dependencies
        run: npm ci

      # 4️⃣ Publish package to GitHub Packages
      # npm reads authentication token from NODE_AUTH_TOKEN
      # GITHUB_TOKEN is auto-generated by GitHub and scoped to this repo
      - name: Publish package
        run: npm publish
        env:
          NODE_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
